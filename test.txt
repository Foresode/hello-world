import 'package:flutter/material.dart';
import 'package:webview_flutter/webview_flutter.dart';
import 'dart:io';
import 'dart:convert';
import 'package:path_provider/path_provider.dart';

class SimpleOfflineWebView extends StatefulWidget {
  @override
  _SimpleOfflineWebViewState createState() => _SimpleOfflineWebViewState();
}

class _SimpleOfflineWebViewState extends State<SimpleOfflineWebView> {
  late WebViewController _controller;

  @override
  void initState() {
    super.initState();
    // 如果你需要在 Android 上启用 Hybrid Composition
    if (Platform.isAndroid) {
      WebView.platform = SurfaceAndroidWebView();
    }
  }

  Future<void> _loadLocalHtml() async {
    try {
      final directory = await getApplicationDocumentsDirectory();
      final file = File('${directory.path}/offline_page.html');
      String htmlContent = await file.readAsString();
      _controller.loadUrl(Uri.dataFromString(
        htmlContent,
        mimeType: 'text/html',
        encoding: utf8,
      ).toString());
    } catch (e) {
      print('Error loading local HTML: $e');
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text("Simple Offline WebView"),
      ),
      body: WebView(
        initialUrl: 'about:blank',
        javascriptMode: JavascriptMode.unrestricted,
        onWebViewCreated: (WebViewController webViewController) {
          _controller = webViewController;
          _loadLocalHtml();
        },
      ),
    );
  }
}

void main() {
  runApp(MaterialApp(
    home: SimpleOfflineWebView(),
  ));
}


<!DOCTYPE html>
<html>
<head>
  <title>Offline Page</title>
</head>
<body>
  <h1>这是一个离线页面</h1>
</body>
</html>
